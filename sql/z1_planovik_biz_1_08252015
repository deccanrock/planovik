-- MySQL dump 10.13  Distrib 5.6.21, for Win64 (x86_64)
--
-- Host: localhost    Database: z1_planovik_biz_1
-- ------------------------------------------------------
-- Server version	5.6.21-log

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `hotel_info`
--

DROP TABLE IF EXISTS `hotel_info`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `hotel_info` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `citycode` varchar(5) NOT NULL,
  `cityname` varchar(25) NOT NULL,
  `hotel` varchar(45) NOT NULL,
  `hotelstar` varchar(25) DEFAULT NULL,
  `ourrating` varchar(25) DEFAULT NULL,
  `room` varchar(45) NOT NULL,
  `fromdate` varchar(25) NOT NULL,
  `todate` varchar(25) NOT NULL,
  `operdays` varchar(12) NOT NULL,
  `convcode` varchar(3) NOT NULL,
  `grp` varchar(3) NOT NULL,
  `epsngl` varchar(12) DEFAULT NULL,
  `epdbl` varchar(12) DEFAULT NULL,
  `cpsngl` varchar(12) DEFAULT NULL,
  `cpdbl` varchar(12) DEFAULT NULL,
  `mapsngl` varchar(12) DEFAULT NULL,
  `mapdbl` varchar(12) DEFAULT NULL,
  `apsngl` varchar(12) DEFAULT NULL,
  `apdbl` varchar(12) DEFAULT NULL,
  `eb` varchar(12) DEFAULT NULL,
  `mealbf` varchar(12) DEFAULT NULL,
  `mealln` varchar(12) DEFAULT NULL,
  `mealdn` varchar(12) DEFAULT NULL,
  `jpsngl` varchar(12) DEFAULT NULL,
  `jpdbl` varchar(12) DEFAULT NULL,
  `mjpsngl` varchar(12) DEFAULT NULL,
  `mjpdbl` varchar(12) DEFAULT NULL,
  `spnoting` varchar(255) DEFAULT NULL,
  `currcode` varchar(3) NOT NULL,
  `rate` varchar(12) NOT NULL,
  `misc` varchar(25) DEFAULT NULL,
  `aisngl` varchar(100) DEFAULT NULL,
  `aidbl` varchar(25) DEFAULT NULL,
  `notitle1` varchar(45) DEFAULT NULL,
  `notitle2` varchar(25) DEFAULT NULL,
  `notitle3` varchar(25) DEFAULT NULL,
  `datecreated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dateupdated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=16384 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_activity_hotel`
--

DROP TABLE IF EXISTS `itin_activity_hotel`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_activity_hotel` (
  `activityid` int(11) NOT NULL AUTO_INCREMENT,
  `itinnum` int(11) NOT NULL,
  `actname` varchar(45) NOT NULL,
  `pax` smallint(5) NOT NULL DEFAULT '0',
  `code` varchar(8) NOT NULL,
  `version` smallint(2) NOT NULL DEFAULT '1',
  `propertyid` int(10) NOT NULL,
  `city` varchar(15) DEFAULT NULL,
  `roomcat` varchar(15) DEFAULT NULL,
  `mealplan` smallint(2) DEFAULT '0',
  `hotelcheckintime` varchar(12) DEFAULT NULL,
  `hotelcheckouttime` varchar(12) DEFAULT NULL,
  `checkindatetime` datetime NOT NULL,
  `checkoutdatetime` datetime NOT NULL,
  `price` decimal(10,2) DEFAULT NULL,
  `pricemarkup` smallint(3) unsigned DEFAULT '0',
  `commentsinternal` varchar(200) DEFAULT NULL,
  `commentsexternal` varchar(200) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `lastupdatedby` int(10) unsigned NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  PRIMARY KEY (`activityid`),
  KEY `fk_code_itin_activity_hotel_idx` (`code`),
  KEY `fk_lastupdateby_itin_activity_hotel_idx` (`lastupdatedby`),
  KEY `fk_itinnum_itin_activity_hotel_idx` (`itinnum`),
  KEY `fk_createddby_itin_activity_hotel_idx` (`createdby`),
  KEY `fk_propertyid_itin_activity_hotel_idx` (`propertyid`),
  CONSTRAINT `fk_createdby_itin_activity_hotel` FOREIGN KEY (`createdby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_itinnum_itin_activity_hotel` FOREIGN KEY (`itinnum`) REFERENCES `itin_master` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_lastupdateby_itin_activity_hotel` FOREIGN KEY (`lastupdatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_propertyid_itin_activity_hotel` FOREIGN KEY (`propertyid`) REFERENCES `service_hotels` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_activity_master`
--

DROP TABLE IF EXISTS `itin_activity_master`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_activity_master` (
  `itinnum` int(11) NOT NULL,
  `tenantid` int(11) NOT NULL,
  `version` smallint(2) NOT NULL,
  `pax` smallint(5) NOT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `countactivityhotel` smallint(3) unsigned NOT NULL DEFAULT '0',
  `countactivityother` smallint(3) unsigned NOT NULL DEFAULT '0',
  `countactivityrental` smallint(3) unsigned NOT NULL DEFAULT '0',
  `countactivitytravel` smallint(3) unsigned NOT NULL DEFAULT '0',
  `countactivityvisit` smallint(3) NOT NULL DEFAULT '0',
  `lastupdatedby` int(10) unsigned NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  PRIMARY KEY (`itinnum`),
  KEY `fk_itinum_itini_activity_master_idx` (`itinnum`),
  KEY `fk_lastupdatedby_itin_activity_master_idx` (`lastupdatedby`),
  CONSTRAINT `fk_itinnum_itin_activity_master` FOREIGN KEY (`itinnum`) REFERENCES `itin_master` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_lastupdatedby_itin_activity_master` FOREIGN KEY (`lastupdatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_activity_master_act`
--

DROP TABLE IF EXISTS `itin_activity_master_act`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_activity_master_act` (
  `itinnum` int(11) NOT NULL,
  `masteractid` smallint(3) NOT NULL DEFAULT '0',
  `masteractname` varchar(45) NOT NULL,
  `masteractstartdate` datetime NOT NULL,
  `masteractenddate` datetime NOT NULL,
  `version` smallint(2) NOT NULL DEFAULT '1',
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  PRIMARY KEY (`itinnum`,`masteractid`),
  CONSTRAINT `fk_itinnum_itin_activity_master_act` FOREIGN KEY (`itinnum`) REFERENCES `itin_activity_master` (`itinnum`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_activity_other`
--

DROP TABLE IF EXISTS `itin_activity_other`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_activity_other` (
  `activityid` int(11) NOT NULL AUTO_INCREMENT,
  `itinnum` int(11) NOT NULL,
  `name` varchar(45) NOT NULL DEFAULT 'Enter Name',
  `pax` smallint(5) DEFAULT '0',
  `code` varchar(8) DEFAULT NULL,
  `version` smallint(2) NOT NULL DEFAULT '0',
  `day` smallint(3) unsigned NOT NULL DEFAULT '0',
  `status` smallint(2) NOT NULL DEFAULT '1',
  `desc` int(30) DEFAULT NULL,
  `cost` decimal(10,2) DEFAULT NULL,
  `costmarkup` int(3) DEFAULT '0',
  `comment` varchar(30) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `dateandtime` datetime DEFAULT NULL,
  `lastupdatedby` int(10) unsigned NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  PRIMARY KEY (`activityid`),
  UNIQUE KEY `activityid_UNIQUE` (`activityid`),
  KEY `fk_code_itin_activity_other_idx` (`code`),
  KEY `fk_lastupdatedby_itin_acitivity_other_idx` (`lastupdatedby`),
  KEY `fk_createdby_itin_acitivity_other_idx` (`createdby`),
  KEY `fk_itinnum_itin_activity_other_idx` (`itinnum`),
  CONSTRAINT `fk_createdby_itin_acitivity_other` FOREIGN KEY (`createdby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_itinnum_itin_activity_other` FOREIGN KEY (`itinnum`) REFERENCES `itin_master` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_lastupdatedby_itin_acitivity_other` FOREIGN KEY (`lastupdatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_activity_travel`
--

DROP TABLE IF EXISTS `itin_activity_travel`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_activity_travel` (
  `activityid` int(11) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `activityidpair` int(11) DEFAULT '0',
  `itinnum` int(11) NOT NULL,
  `actname` varchar(60) NOT NULL DEFAULT 'Enter Name',
  `pax` smallint(5) DEFAULT '0',
  `mode` smallint(3) DEFAULT '0',
  `code` varchar(20) NOT NULL,
  `version` smallint(2) NOT NULL DEFAULT '1',
  `vesselconame` varchar(20) DEFAULT NULL,
  `vesselnoon` varchar(15) DEFAULT NULL,
  `vesselnoret` varchar(15) DEFAULT NULL,
  `bookingclass` varchar(10) DEFAULT NULL,
  `bookingno` varchar(10) DEFAULT NULL,
  `depdatetimeon` datetime DEFAULT NULL,
  `depdatetimeret` datetime DEFAULT NULL,
  `arrdatetimeret` datetime DEFAULT NULL,
  `arrdatetimeon` datetime DEFAULT NULL,
  `depstation` varchar(15) DEFAULT NULL,
  `arrstation` varchar(15) DEFAULT NULL,
  `cost` decimal(10,2) DEFAULT '0.00',
  `costmarkup` smallint(3) DEFAULT '0',
  `pikupdroplocfrom` varchar(30) DEFAULT NULL,
  `pikupdroplocto` varchar(30) DEFAULT NULL,
  `pikupdropdatetime` datetime DEFAULT NULL,
  `pikupdropcost` decimal(10,2) DEFAULT '0.00',
  `pikupdropcostmarkup` smallint(3) DEFAULT '0',
  `vehdetails` varchar(45) DEFAULT 'none',
  `asstcost` decimal(10,2) DEFAULT '0.00',
  `asstcostmarkup` smallint(3) DEFAULT '0',
  `commentsinternal` varchar(200) DEFAULT NULL,
  `commentsexternal` varchar(200) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `lastupdatedby` int(10) unsigned NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  PRIMARY KEY (`activityid`,`itinnum`),
  UNIQUE KEY `activityid_UNIQUE` (`activityid`),
  KEY `fk_code_itin_activity_codes_itin_activity_travel` (`code`),
  KEY `fk_lastupdatedby_itin_activity_travel_idx` (`lastupdatedby`),
  KEY `fk_itinnum_itin_activity_travel` (`itinnum`),
  KEY `fk_createdby_itin_activity_travel` (`createdby`),
  CONSTRAINT `fk_createdby_itin_activity_travel` FOREIGN KEY (`createdby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_itinnum_itin_activity_travel` FOREIGN KEY (`itinnum`) REFERENCES `itin_master` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_lastupdatedby_itin_activity_travel` FOREIGN KEY (`lastupdatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_activity_visit`
--

DROP TABLE IF EXISTS `itin_activity_visit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_activity_visit` (
  `activityid` int(11) NOT NULL AUTO_INCREMENT,
  `itinnum` int(11) NOT NULL,
  `name` varchar(45) NOT NULL DEFAULT 'Enter Name',
  `pax` smallint(5) DEFAULT '0',
  `code` varchar(8) NOT NULL,
  `version` smallint(2) NOT NULL DEFAULT '0',
  `day` smallint(3) DEFAULT NULL,
  `placename` varchar(20) DEFAULT NULL,
  `city` varchar(15) DEFAULT NULL,
  `guidename` varchar(20) DEFAULT NULL,
  `guiderate` decimal(10,2) DEFAULT NULL,
  `guideratemarkup` smallint(3) unsigned DEFAULT '0',
  `entrancefees` decimal(10,2) DEFAULT NULL,
  `entrancefeesmarkup` smallint(3) unsigned DEFAULT '0',
  `escortreq` smallint(1) DEFAULT '0',
  `escortfeesmarkup` smallint(3) unsigned DEFAULT NULL,
  `comment` varchar(30) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `escortfees` decimal(10,2) DEFAULT NULL,
  `status` smallint(2) unsigned NOT NULL DEFAULT '1',
  `dateandtime` datetime DEFAULT NULL,
  `lastupdatedby` int(11) unsigned NOT NULL,
  `createdby` int(11) unsigned NOT NULL,
  PRIMARY KEY (`activityid`),
  UNIQUE KEY `activityid_UNIQUE` (`activityid`),
  KEY `fk_code_itin_activity_visit_idx` (`code`),
  KEY `fk_lastupdatedby_itin_activity_visit_idx` (`lastupdatedby`),
  KEY `fk_createdby_itin_activity_visit_idx` (`createdby`),
  KEY `fk_itinnum_itin_activity_visit_idx` (`itinnum`),
  CONSTRAINT `fk_createdby_itin_activity_visit` FOREIGN KEY (`createdby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_itinnum_itin_activity_visit` FOREIGN KEY (`itinnum`) REFERENCES `itin_master` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_lastupdatedby_itin_activity_visit` FOREIGN KEY (`lastupdatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_currconv`
--

DROP TABLE IF EXISTS `itin_currconv`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_currconv` (
  `convcode` int(11) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `fromcurr` varchar(3) NOT NULL,
  `tocurr` varchar(3) NOT NULL,
  `status` smallint(2) NOT NULL DEFAULT '0',
  `unitrate` float NOT NULL,
  `datecreated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dateupdated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`convcode`),
  UNIQUE KEY `conv_code_UNIQUE` (`convcode`),
  UNIQUE KEY `unq_fromcurrtocurrunitrate` (`fromcurr`,`tocurr`,`unitrate`),
  KEY `fk_fromcurr_itin_currconv_idx` (`fromcurr`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_daywise`
--

DROP TABLE IF EXISTS `itin_daywise`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_daywise` (
  `itinnum` int(11) NOT NULL,
  `type` smallint(2) NOT NULL,
  `activityid` int(11) NOT NULL,
  `daynum` smallint(3) NOT NULL,
  PRIMARY KEY (`itinnum`,`type`,`activityid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_master`
--

DROP TABLE IF EXISTS `itin_master`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_master` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `name` varchar(50) NOT NULL,
  `version` smallint(2) NOT NULL,
  `status` smallint(2) NOT NULL DEFAULT '0',
  `touroperator` varchar(30) NOT NULL DEFAULT 'Direct Query',
  `grouphead` varchar(30) NOT NULL DEFAULT 'Fill',
  `numtravellers` smallint(6) NOT NULL DEFAULT '0',
  `startdate` datetime DEFAULT NULL,
  `enddate` datetime DEFAULT NULL,
  `arrivalcity` varchar(30) NOT NULL DEFAULT 'Fill',
  `depcity` varchar(30) NOT NULL DEFAULT 'Fill',
  `currency` varchar(3) NOT NULL DEFAULT 'INR',
  `quotecurrency` varchar(3) DEFAULT 'INR',
  `convcode` int(11) DEFAULT '1',
  `tzoffset` smallint(6) NOT NULL DEFAULT '-330',
  `datecreated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `createdby` int(10) unsigned NOT NULL,
  `dateupdated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `lastupdatedby` int(10) unsigned NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name_UNIQUE` (`name`),
  UNIQUE KEY `id_UNIQUE` (`id`),
  KEY `fk_convcode_itin_currencies_idx` (`convcode`),
  KEY `fk_createdby_itin_master_idx` (`createdby`),
  KEY `fk_lastupdatedby_itin_master_idx` (`lastupdatedby`),
  KEY `fk_currency_idx` (`currency`),
  CONSTRAINT `fk_convcode_itin_master` FOREIGN KEY (`convcode`) REFERENCES `itin_currconv` (`convcode`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `itin_pax_info`
--

DROP TABLE IF EXISTS `itin_pax_info`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `itin_pax_info` (
  `itinnum` int(11) NOT NULL,
  `groupnum` smallint(3) DEFAULT '1',
  `name` varchar(45) NOT NULL,
  `age` smallint(6) DEFAULT NULL,
  `nationality` varchar(45) DEFAULT NULL,
  `passportdet` varchar(60) DEFAULT NULL,
  `visadet` varchar(60) DEFAULT NULL,
  `grouphead` int(1) DEFAULT '0',
  `contactemail` varchar(120) DEFAULT NULL,
  `contactphonell` varchar(15) DEFAULT NULL,
  `contactphonemobile` varchar(15) DEFAULT NULL,
  `contactaddress` varchar(120) DEFAULT NULL,
  `comments` varchar(45) DEFAULT NULL,
  `disability` varchar(15) DEFAULT NULL,
  `languages` varchar(45) DEFAULT 'English',
  `datecreated` datetime DEFAULT NULL,
  `dateupdated` datetime DEFAULT NULL,
  PRIMARY KEY (`itinnum`),
  KEY `fk_itinnum_itin_pax_info_idx` (`itinnum`),
  CONSTRAINT `fk_itinum_itin_pax_info` FOREIGN KEY (`itinnum`) REFERENCES `itin_master` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `service_airlines`
--

DROP TABLE IF EXISTS `service_airlines`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `service_airlines` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `servicename` varchar(45) NOT NULL,
  `iatacode` varchar(3) DEFAULT NULL,
  `rating` smallint(1) DEFAULT NULL,
  `city` varchar(45) DEFAULT NULL,
  `country` varchar(45) DEFAULT NULL,
  `contactname` varchar(30) DEFAULT NULL,
  `contactphone` varchar(15) DEFAULT NULL,
  `contactemail` varchar(120) DEFAULT NULL,
  `contactwebsite` varchar(100) DEFAULT NULL,
  `fullservice` int(1) DEFAULT NULL,
  `domesticonly` int(1) DEFAULT NULL,
  `addlinfo` varchar(200) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  `updatedby` int(10) unsigned NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `servicename_UNIQUE` (`servicename`),
  KEY `fk_createdby_itin_airlines_idx` (`createdby`),
  KEY `fk_updatedby_itin_airlines_idx` (`updatedby`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `service_hotels`
--

DROP TABLE IF EXISTS `service_hotels`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `service_hotels` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `servicename` varchar(100) NOT NULL,
  `city` varchar(45) DEFAULT NULL,
  `country` varchar(45) DEFAULT NULL,
  `contactphone` varchar(15) DEFAULT NULL,
  `contactemail` varchar(120) DEFAULT NULL,
  `contactwebsite` varchar(100) DEFAULT NULL,
  `contactname` varchar(45) DEFAULT NULL,
  `rating` smallint(1) DEFAULT NULL,
  `addlinfo` varchar(200) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  `updatedby` int(10) unsigned NOT NULL,
  PRIMARY KEY (`id`,`servicename`),
  UNIQUE KEY `servicename_UNIQUE` (`servicename`),
  KEY `fk_createdby_itin_hotels_idx` (`createdby`),
  KEY `fk_updatedby_itin_hotels_idx` (`updatedby`),
  CONSTRAINT `fk_createdby_itin_hotels` FOREIGN KEY (`createdby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_updatedby_itin_hotels` FOREIGN KEY (`updatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `service_other`
--

DROP TABLE IF EXISTS `service_other`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `service_other` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `servicename` varchar(45) NOT NULL,
  `description` varchar(120) DEFAULT NULL,
  `rating` smallint(1) DEFAULT NULL,
  `city` varchar(45) DEFAULT NULL,
  `country` varchar(45) DEFAULT NULL,
  `contactname` varchar(45) DEFAULT NULL,
  `contactphone` varchar(15) DEFAULT NULL,
  `contactemail` varchar(120) DEFAULT NULL,
  `contactwebsite` varchar(100) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  `updatedby` int(10) unsigned NOT NULL,
  `addlinfo` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `servicename_UNIQUE` (`servicename`),
  KEY `fk_itin_service_other_createdby_idx` (`createdby`),
  KEY `fk_itin_service_other_updatedby_idx` (`updatedby`),
  CONSTRAINT `fk_itin_service_other_createdby` FOREIGN KEY (`createdby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_itin_service_other_updatedby` FOREIGN KEY (`updatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `service_transport`
--

DROP TABLE IF EXISTS `service_transport`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `service_transport` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `servicename` varchar(60) NOT NULL,
  `city` varchar(45) DEFAULT NULL,
  `country` varchar(45) DEFAULT NULL,
  `contactphone` varchar(30) DEFAULT NULL,
  `contactemail` varchar(120) DEFAULT NULL,
  `contactwebsite` varchar(120) DEFAULT NULL,
  `contactname` varchar(45) DEFAULT NULL,
  `rating` smallint(1) DEFAULT NULL,
  `coverage` smallint(2) DEFAULT NULL,
  `addlinfo` varchar(200) DEFAULT NULL,
  `datecreated` datetime NOT NULL,
  `dateupdated` datetime NOT NULL,
  `createdby` int(10) unsigned NOT NULL,
  `updatedby` int(10) unsigned NOT NULL,
  `tenantid` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `servicename_UNIQUE` (`servicename`),
  KEY `fk_createdby_itin_cab_cos_idx` (`createdby`),
  KEY `fk_updatedby_itin_cab_cos_idx` (`updatedby`),
  CONSTRAINT `fk_createdby_itin_cab_cos` FOREIGN KEY (`createdby`) REFERENCES `users` (`id`) ON UPDATE CASCADE,
  CONSTRAINT `fk_updatedby_itin_cab_cos` FOREIGN KEY (`updatedby`) REFERENCES `users` (`id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `user_login_attempts`
--

DROP TABLE IF EXISTS `user_login_attempts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `user_login_attempts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `username` varchar(30) NOT NULL,
  `attempts` int(2) NOT NULL,
  `lastModified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `fk_username_user_login_attempts_idx` (`username`),
  CONSTRAINT `fk_username_user_login_attempts` FOREIGN KEY (`username`) REFERENCES `users` (`username`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `user_roles`
--

DROP TABLE IF EXISTS `user_roles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `user_roles` (
  `roleid` int(5) unsigned NOT NULL AUTO_INCREMENT,
  `role` varchar(25) NOT NULL,
  `datecreated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dateupdated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`roleid`),
  UNIQUE KEY `unq_username_role` (`role`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `user_roles_map`
--

DROP TABLE IF EXISTS `user_roles_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `user_roles_map` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `username` varchar(30) NOT NULL,
  `role` varchar(25) NOT NULL,
  `datecreated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dateupdated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `unq_username_tenantid` (`username`,`tenantid`),
  KEY `fk_username_user_roles_map_idx` (`username`),
  KEY `fk_role_user_roles_map_idx` (`role`),
  CONSTRAINT `fk_role_user_roles_map` FOREIGN KEY (`role`) REFERENCES `user_roles` (`role`) ON UPDATE CASCADE,
  CONSTRAINT `fk_username_user_roles_map` FOREIGN KEY (`username`) REFERENCES `users` (`username`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `users` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `tenantid` int(11) NOT NULL,
  `email` varchar(120) NOT NULL,
  `fullname` varchar(60) NOT NULL,
  `username` varchar(30) NOT NULL,
  `password` varchar(60) NOT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `designation` varchar(30) DEFAULT NULL,
  `reportsto` int(10) NOT NULL DEFAULT '1',
  `createdby` int(10) NOT NULL DEFAULT '1',
  `level` int(3) NOT NULL DEFAULT '0',
  `enabled` tinyint(1) NOT NULL DEFAULT '1',
  `accountNonExpired` tinyint(1) NOT NULL DEFAULT '1',
  `accountNonLocked` tinyint(1) NOT NULL DEFAULT '1',
  `credentialsNonExpired` tinyint(1) NOT NULL DEFAULT '1',
  `tzoffset` int(6) DEFAULT NULL,
  `date_created` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `date_updated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `unq_username_tenantid` (`tenantid`,`username`),
  KEY `IDX_username` (`username`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping routines for database 'z1_planovik_biz_1'
--
/*!50003 DROP PROCEDURE IF EXISTS `sp_createcurrconvcode` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_createcurrconvcode`(
	IN intocurr VARCHAR(3),
    IN infromcurr VARCHAR(3),
    IN inunitrate float,
    IN instatus SMALLINT(2),
    IN intenantid INT(11),
    OUT result VARCHAR(30)
)
BEGIN

	DECLARE newconvcode INT(11);
    
    IF (Select count(*) from itin_currconv where fromcurr=infromcurr and tocurr=intocurr and tenantid = intenantid and unitrate=inunitrate = 1) THEN
		Select convcode INTO @newconvcode from itin_currconv where fromcurr=infromcurr and tocurr=intocurr and unitrate=inunitrate and unitrate=inunitrate;
        SELECT CONCAT(@newconvcode, ' - ', infromcurr, ' to ', intocurr, '  Rate: ', inunitrate) INTO result;
    ELSE
		Insert into itin_currconv (tenantid, fromcurr, tocurr, unitrate, status, datecreated, dateupdated) values (intenantid, infromcurr,
        intocurr, inunitrate, instatus, UTC_TIMESTAMP(),  UTC_TIMESTAMP());
        SELECT LAST_INSERT_ID() INTO @newconvcode;
        SELECT CONCAT(@newconvcode, ' - ', infromcurr, ' to ', intocurr, '  Rate: ', inunitrate) INTO result;
    END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_createeditmasteractnamedet` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_createeditmasteractnamedet`(
	IN	initinnum				INT(11),
    IN	inversion				SMALLINT(2),
    IN	inmasteractname			VARCHAR(45),
    IN	inmasteractstartdate 	DATETIME,
    IN	inmasteractenddate		DATETIME,
    IN 	inmasteractid			SMALLINT(3),
	OUT outmasteractid			VARCHAR(3)
)
BEGIN
	DECLARE actcnt			SMALLINT(3);
    DECLARE newmasteractid 	SMALLINT(3);
    
    
    IF (inmasteractid = 0) THEN

		Select count(*) INTO @actcnt from itin_activity_master_act where itinnum = initinnum and version = inversion;
		
		IF (@actcnt = 0) THEN
			Set @newmasteractid = 0;
		ELSE
			Select max(masteractid) into @newmasteractid from itin_activity_master_act where itinnum = initinnum and version = inversion;
		END IF;


		Insert into itin_activity_master_act (itinnum, masteractid, masteractname, masteractstartdate, masteractenddate,
		version, datecreated, dateupdated) Values (initinnum, @newmasteractid+1, inmasteractname, inmasteractstartdate, inmasteractenddate,
		inversion, UTC_TIMESTAMP(), UTC_TIMESTAMP());

		Select max(masteractid) into outmasteractid from itin_activity_master_act where itinnum = initinnum and version = inversion;


	ELSE
		Update itin_activity_master_act set masteractname=inmasteractname, masteractstartdate=inmasteractstartdate,
        masteractenddate=inmasteractenddate, dateupdated=UTC_TIMESTAMP() where itinnum=initinnum and
        masteractid=inmasteractid and version=inversion;
	
		Select inmasteractid into outmasteractid;
    END IF;
	

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_create_itinerary` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_create_itinerary`(
	IN name VARCHAR(50),
    IN version SMALLINT(2),
    IN status SMALLINT(2),
    IN currency VARCHAR(3),    
    IN quotecurrency VARCHAR(3),
    IN tzoffset SMALLINT,
    IN createdbyusername VARCHAR(30),
    IN tenantid INT(11),
    OUT itinnum INT(11)
)
BEGIN
	DECLARE createdby INT(11);
    	
	Select id INTO @createdby from users where username=createdbyusername and tenantid=tenantid;
    
	INSERT INTO itin_master (id, tenantid, name, version, status, tzoffset, currency, quotecurrency, createdby, lastupdatedby) 
	VALUES (NULL, tenantid, name, version, status, tzoffset, currency, quotecurrency, @createdby, @createdby);
	SELECT LAST_INSERT_ID() INTO itinnum;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_deletemasteract` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_deletemasteract`(
	IN	initinnum				INT(11),
    IN	inversion				SMALLINT(2),
    IN 	inmasteractid			SMALLINT(3)
)
BEGIN
		Delete from itin_activity_master_act where itinnum = initinnum and version = inversion and
        masteractid = inmasteractid;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_delete_activity` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_delete_activity`(
	IN		inactivityid	 INT(11),
	IN		inactivityidpair INT(11),
    IN		initinnum		 INT(11),
    IN		intype			 SMALLINT(2),
    IN		inversion		 SMALLINT(2)

)
BEGIN
	IF (intype = 0) THEN
		Delete from itin_activity_travel where activityid = inactivityid and itinnum = initinnum;
        IF (inactivityidpair > 0) THEN
			Delete from itin_activity_travel where activityid = inactivityidpair and itinnum = initinnum;
			Update itin_activity_master Set countactivitytravel = countactivitytravel-2, dateupdated = UTC_TIMESTAMP() where
				itinnum = initinnum and version = inversion;
        ELSE
			Update itin_activity_master Set countactivitytravel = countactivitytravel-1, dateupdated = UTC_TIMESTAMP() where
				itinnum = initinnum and version = inversion;
		END IF;
        
    ELSEIF (intype = 1) THEN    
		Delete from itin_activity_hotel where activityid = inactivityid and itinnum = initinnum;
		Update itin_activity_master Set countactivityhotel = countactivityhotel-1, dateupdated = UTC_TIMESTAMP() where
            itinnum = initinnum and version = inversion;

    ELSEIF (intype = 2) THEN    
		Delete from itin_activity_rental where activityid = inactivityid and itinnum = initinnum;
		Update itin_activity_master Set countactivityrental = countactivityrental-1, dateupdated = UTC_TIMESTAMP() where
            itinnum = initinnum and version = inversion;
        
    ELSEIF (intype = 3) THEN    
		Delete from itin_activity_visit where activityid = inactivityid and itinnum = initinnum;
		Update itin_activity_master Set countactivityvisit = countactivityvisit-1, dateupdated = UTC_TIMESTAMP() where
            itinnum = initinnum and version = inversion;
        
    ELSEIF (intype = 4) THEN    
		Delete from itin_activity_other where activityid = inactivityid and itinnum = initinnum;
		Update itin_activity_master Set countactivityother = countactivityother-1, dateupdated = UTC_TIMESTAMP() where
            itinnum = initinnum and version = inversion;
        
    END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_delete_user` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_delete_user`(
	IN inusername VARCHAR(100),
    IN intenantid INT(11)
)
BEGIN

	update users set enabled=0, date_updated=UTC_TIMESTAMP() where username=inusername and tenantid=intenantid;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getactivitycodes` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getactivitycodes`(
	IN codetype VARCHAR (30)
)
BEGIN

	IF (codetype = '') THEN
		select code AS activitycodedesc from itin_activity_codes;
        
	ELSEIF (codetype = 'travel') THEN
		select code AS activitycodedesc from itin_activity_codes where LEFT(code,1)='T';

	ELSEIF (codetype = 'rental') THEN
		select code AS activitycodedesc from itin_activity_codes where LEFT(code,1)='R';

	ELSEIF (codetype = 'hotel') THEN
		select code AS activitycodedesc from itin_activity_codes where LEFT(code,1)='H';

	ELSEIF (codetype = 'visit') THEN
		select code AS activitycodedesc from itin_activity_codes where LEFT(code,1)='V';

	ELSEIF (codetype = 'other') THEN
		select code AS activitycodedesc from itin_activity_codes where LEFT(code,1)='O';
	
    END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getconvcodedetails` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getconvcodedetails`(	
	IN currconvcode INT(11),
    IN tenantid INT(11),
    OUT outfromcurr VARCHAR(3),
    OUT outtocurr	 VARCHAR(3),
    OUT outstatus   SMALLINT(2),
    OUT outunitrate FLOAT,
    OUT outdatecreated DATETIME,
    OUT outdateupdated DATETIME
)
BEGIN
	Select fromcurr, tocurr, status, unitrate, datecreated, dateupdated INTO outfromcurr, 
    outtocurr, outstatus, outunitrate, outdatecreated, outdateupdated from itin_currconv where convcode=currconvcode and tenantid=tenantid;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getcurrconvcodes` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getcurrconvcodes`(        
	IN  query		VARCHAR(30),
    IN  intenantid	INT(11),
    IN	instatus 	SMALLINT(2)
)
BEGIN
		SELECT CONCAT(convcode, ' - ', fromcurr, ' to ', tocurr, '  Rate: ', unitrate) AS isocurrcodedesc FROM itin_currconv 
          WHERE fromcurr LIKE CONCAT("%", query, "%") and status=instatus and tenantid = intenantid order by convcode desc LIMIT 0, 20;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getidnamelist` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getidnamelist`(
        IN  query		               	VARCHAR(30)
)
BEGIN

SELECT CONCAT(name, ' ', orgid) AS orgidname FROM plnvk_org_seq WHERE name LIKE CONCAT("%", query, "%") LIMIT 0, 20;


END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getisocurrencydetails` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getisocurrencydetails`(
	IN inisocode VARCHAR(3),
    OUT outid INT(10),
    OUT outcurrdesc VARCHAR(20)
)
BEGIN
	Select id, currdesc into outid, outcurrdesc from isocurrencies where isocode=inisocode;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getisocurrlist` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getisocurrlist`(        
	IN  query	VARCHAR(30)
)
BEGIN
		SELECT CONCAT(isocode, ' - ', currdesc) AS isocurrcodedesc FROM isocurrencies WHERE isocode LIKE CONCAT("%", query, "%") order by currdesc LIMIT 0, 20;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getitinactivitycount` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getitinactivitycount`(
	IN  initinnum INT(11),
    IN  inversion INT(2)
)
BEGIN
	Select c.day, (select count(*) as cnt from itin_activity_master c2  where
		c2.itinnum = itinnum and c2.version=inversion and c2.day = c.day) as day from itin_activity_master c
		order by day asc;    
    
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getitinactivitymasterdet` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getitinactivitymasterdet`(
	IN  initinnum 				INT(11),
    IN  inversion 				INT(6),
    IN	ingroupnum 				SMALLINT(3),
    OUT outitinnum				INT(11),
    OUT	outversion				SMALLINT(2),
    OUT	outpax					SMALLINT(5),
    OUT	outgroupnum				SMALLINT(3),
    OUT outcountactivityhotel 	SMALLINT(3),
    OUT outcountactivityother	SMALLINT(3),
    OUT outcountactivityvisit	SMALLINT(3),
    OUT outcountactivitytravel	SMALLINT(3),
    OUT outcountactivityrental	SMALLINT(3)    
)
BEGIN
	Select itinnum, version, pax, groupnum, countactivityhotel, countactivityother, countactivityvisit, countactivitytravel, countactivityrental 
    INTO outitinnum, outversion, outpax, outgroupnum, outcountactivityhotel, outcountactivityother, outcountactivityvisit, outcountactivitytravel, outcountactivityrental
    from itin_activity_master where itinnum = initinnum and version = inversion and groupnum = ingroupnum;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getitinidnamelist` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getitinidnamelist`(
        IN  query		VARCHAR(30),
        IN 	intenantid	INT(11),				
        IN 	isnumber	INT(1)
)
BEGIN
	DECLARE strnumber INT(11);      
        		       
	IF (isnumber = 1) THEN
		SET @strnumber := CONVERT(query, UNSIGNED);
		SELECT CONCAT(id, ' - ', name) AS itinnumbername FROM itin_master WHERE id LIKE CONCAT("%", @strnumber, "%") and tenantid=intenantid order by dateupdated desc LIMIT 0, 20;
	ELSE
		SELECT CONCAT(id, ' - ', name) AS itinnumbername FROM itin_master WHERE name LIKE CONCAT("%", query, "%")  and tenantid=intenantid order by dateupdated desc LIMIT 0, 20;
        
        END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getmasteractivityactdet` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getmasteractivityactdet`(
	IN initinnum INT(11),
    IN inversion SMALLINT(2)
)
BEGIN
	SELECT  itinnum, masteractid, masteractname, masteractstartdate, masteractenddate, version, datecreated, dateupdated FROM itin_activity_master_act 
	  WHERE itinnum = initinnum and version = inversion order by masteractid;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getmasteractnamedet` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getmasteractnamedet`(
	IN initinnum INT(11),
    IN inmasteractid SMALLINT(3)
)
BEGIN
	Select itinnum, masteractid, masteractname, masteractstartdate, masteractenddate, datedcreated, dateupdated
    from itin_activity_master_act where itinnum = initinnum and masteractid = inmasteractid;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getorgdetails` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getorgdetails`(
        IN  orgid	VARCHAR(20)
)
BEGIN
    DECLARE tblnum VARCHAR(1);
    DECLARE tblname VARCHAR(15);
	DECLARE sqltext VARCHAR(300);
    DECLARE name VARCHAR(120);
    DECLARE shortname VARCHAR(120);
    DECLARE ip VARCHAR(45);
    DECLARE regcode VARCHAR(45);
    DECLARE regcodeissuingauthority VARCHAR(45);
    DECLARE isocountrycode VARCHAR(3);
    DECLARE logosealloc VARCHAR(200);
    DECLARE addrstreet1 VARCHAR(100);
    DECLARE addrstreet2 VARCHAR(100);
    DECLARE addrcitytown VARCHAR(60);
    DECLARE addrdistrict VARCHAR(60);
    DECLARE addrstateprovrgn VARCHAR(80);
    DECLARE addrpostalcode VARCHAR(20);
    DECLARE addrhomeurl VARCHAR(120);    
    DECLARE contacttitle VARCHAR(10);  
    DECLARE contactname VARCHAR(60);    
    DECLARE contactphoneoffice VARCHAR(20);    
    DECLARE contactphonemobile VARCHAR(20);    
    DECLARE contactemail VARCHAR(100);    
    DECLARE contactdesignation VARCHAR(45);
    DECLARE contactip VARCHAR(45);
    DECLARE type VARCHAR(20);
    DECLARE subtype VARCHAR(45);
    DECLARE status VARCHAR(15);
    DECLARE vrfreqcnt int(10);
    DECLARE vrfproccnt int(10);
    DECLARE alrtpendingcnt int(5);
    DECLARE msgsunrdcnt int(5);
    DECLARE accntbal decimal(10,2);
    DECLARE payoutbal decimal(10,2);
    DECLARE payoutdate datetime;
    DECLARE tzoffset smallint(6);
    DECLARE datecreated datetime;
    DECLARE dateupdated datetime;
    
	BEGIN
    
		SELECT SUBSTRING(orgid FROM (CHAR_LENGTH(orgid)) FOR 1) INTO @tblnum;
		SELECT CONCAT('plnvk_org_', @tblnum) INTO @tblname;

		SET @sqltext :=  CONCAT('select orgid, name, shortname, ip, regcode, regcodeissuingauthority, isocountrycode,
								logosealloc, addrstreet1, addrstreet2, addrcitytown, addrdistrict, addrstateprovrgn,
                                addrpostalcode, addrhomeurl, contacttitle, contactname, contactphoneoffice, contactphonemobile,
                                contactemail, contactdesignation, contactip, type, subtype, status, vrfreqcnt, vrfproccnt,
                                alrtpendingcnt, msgsunrdcnt, accntbal, payoutbal, payoutdate, tzoffset, datecreated, dateupdated
								from ', @tblname, ' where orgid=', '\'', orgid, '\'');
                
		PREPARE stmt FROM @sqltext;
		EXECUTE stmt;
		DEALLOCATE PREPARE stmt;                
	END;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getpasssalt` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getpasssalt`(
        IN  username	               	VARCHAR(20),
        OUT salt						VARCHAR(16),
        OUT pass						VARCHAR(20)
)
BEGIN
		select salt, pass INTO salt, pass from users where username = username;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getreportingmanagers` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getreportingmanagers`(
        IN  	inuserid 	INT(10),
        IN		intenantid	INT(11)
)
BEGIN
	Select  username from users where id = (Select reportsto from users where id=inuserid and tenantid=intenantid) 
    UNION ALL
   	Select  username from users where id = (Select createdby from users where id=inuserid and tenantid=intenantid);

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getservice` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getservice`(
        IN  inservicename	            VARCHAR(45), 
        IN	type						SMALLINT(1),
        IN	intenantid					INT(11)        
)
BEGIN
		IF (type = 0) THEN
				Select id, tenantid, servicename, iatacode, rating, city, country, contactname, contactphone, contactemail,
				contactwebsite, fullservice, domesticonly, addlinfo, datecreated, createdby, dateupdated, updatedby 
                from service_airlines where servicename=inservicename and tenantid=intenantid;

		ELSEIF (type = 1) THEN
				Select id, tenantid, servicename, rating, city, country, contactname, contactphone, contactemail,
				contactwebsite, addlinfo, datecreated, createdby, dateupdated, updatedby from service_hotels 
				where servicename=inservicename and tenantid=intenantid;
        
        ELSEIF (type = 2) THEN
				Select id, tenantid, servicename, rating, coverage, city, country, contactname, contactphone, contactemail,
				contactwebsite, addlinfo, datecreated, createdby, dateupdated, updatedby from service_transport
				where servicename=inservicename and tenantid=intenantid;
		
        ELSEIF (type = 3) THEN
				Select id, tenantid, servicename, description, rating, city, country, contactname, contactphone, contactemail,
				contactwebsite, addlinfo, datecreated, createdby, dateupdated, updatedby from service_other
				where servicename=inservicename and tenantid=intenantid;
        
        END IF;            
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_gettenantfordomain` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_gettenantfordomain`(
	intenantname	VARCHAR(20)
)
BEGIN
	Select tenantid, tenantdesc, tenantname, datastore, regip, zoneid, addrstreet1, addrstreet2, addrcitytown,
    addrdistrict, addrstateprovrgn, addrpostalcode, addrhomeurl, contacttitle, contactname, contactphoneoffice,
    contactphonemobile, contactemail, contactdesignation, regtype, regstatus, alrtpendingcnt, msgsunrdcnt, accntbal,
    tzoffset, datecreated, dateupdated, createdby, updatedby from plnvk_tenant_master where tenantname=intenantname;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_gettenants` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_gettenants`(
)
BEGIN

	Select tenantid, tenantdesc, tenantname, datastore, regip, zoneid, addrstreet1, addrstreet2, addrcitytown,
    addrdistrict, addrstateprovrgn, addrpostalcode, addrhomeurl, contacttitle, contactname, contactphoneoffice,
    contactphonemobile, contactemail, contactdesignation, regtype, regstatus, alrtpendingcnt, msgsunrdcnt, accntbal,
    tzoffset, datecreated, dateupdated, createdby, updatedby from plnvk_tenant_master;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_getuserdetails` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_getuserdetails`(
        IN  	inusername VARCHAR(30),
        IN		intenantid INT(11)
)
BEGIN
    
	Select t1.id, t1.fullname, t1.password, t1.email, t1.username, t1.phone, t1.designation, t1.level, t1.enabled, t1.accountNonExpired,
    t1.accountNonLocked, t1.credentialsNonExpired, t1.tzoffset, t1.date_created, t1.date_updated, t2.role from 
    users t1, user_roles_map t2 where t1.username = inusername and 
    t2.username= inusername and t1.tenantid = intenantid and t2.tenantid = intenantid;
    

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_get_activities_for_type` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_activities_for_type`(
	IN	itinnum		INT(11),
	IN	version		SMALLINT(2),
    IN  type 		SMALLINT(2),
    IN	tenantid	INT(11)
)
BEGIN

	
    IF (type = 0) THEN
		select a.activityid, a.activityidpair, a.tenantid, a.itinnum, a.actname, a.pax, a.mode, a.code, a.version, a.vesselconame, a.vesselnoon, a.vesselnoret,
		a.bookingclass, a.bookingno, a.depdatetimeon, a.depdatetimeret, a.arrdatetimeon, a.arrdatetimeret, a.depstation, a.arrstation, a.cost, a.costmarkup, a.pikupdroplocfrom,
		a.pikupdroplocto, a.pikupdropdatetime, a.pikupdropcost, a.pikupdropcostmarkup, a.vehdetails, a.asstcost, a.asstcostmarkup,
		a.commentsinternal, a.commentsexternal, a.datecreated, a.dateupdated, a.lastupdatedby, a.createdby from itin_activity_travel a where a.itinnum = itinnum 
        and a.version = version and a.tenantid = tenantid order by a.activityid ASC;
    END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_get_activitypairdet` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_activitypairdet`(
	IN	inactivityid	INT(11),
	IN  type 			SMALLINT(2),
    IN 	tenantid		INT(11),
    OUT	outdepdatetimeon long,
    OUT	outarrdatetimeon long,
    OUT	outdepdatetimeret long,
    OUT	outarrdatetimeret long
)
BEGIN
	IF (type = 0) THEN
    BEGIN
		Select UNIX_TIMESTAMP(depdatetimeon) * 1000, UNIX_TIMESTAMP(depdatetimeret) * 1000, UNIX_TIMESTAMP(arrdatetimeon) * 1000, UNIX_TIMESTAMP(arrdatetimeret) * 1000
        INTO outdepdatetimeon, outdepdatetimeret, outarrdatetimeon, outarrdatetimeret from itin_activity_travel where activityid=inactivityid and tenantid=tenantid; 
    END;
	END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_get_activity_details` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_activity_details`(
	IN	activityid	INT(11),
    IN  type 		SMALLINT(2),
    IN	tenantid	INT(11)
)
BEGIN
	
    IF (type = 0) THEN
		select a.activityid, a.activityidpair, a.tenantid, a.itinnum, a.actname, a.pax, a.mode, a.code, a.version, a.vesselconame, a.vesselnoon, a.vesselnoret,
		a.bookingclass, a.bookingno, a.depdatetimeon, a.arrdatetimeon, a.depdatetimeret, a.arrdatetimeret, a.depstation, a.arrstation, a.cost, a.costmarkup, a.pikupdroplocfrom,
		a.pikupdroplocto, a.pikupdropdatetime, a.pikupdropcost, a.pikupdropcostmarkup, a.vehdetails, a.asstcost, a.asstcostmarkup,
		a.commentsinternal, a.commentsexternal, a.datecreated, a.dateupdated, a.lastupdatedby, a.createdby from itin_activity_travel a where a.activityid = activityid and a.tenantid=tenantid;
	END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_get_itinerary` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_itinerary`(
	IN itinum 	INT(11),
    IN tenantid INT(11)
)
BEGIN
    
	Select id, name, version, status, touroperator, grouphead, numtravellers, startdate, enddate, arrivalcity, depcity, 
	currency, quotecurrency, convcode, tzoffset, createdby, datecreated, lastupdatedby, dateupdated from itin_master where id=itinum and tenantid=tenantid;    
    
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_get_serviceinfo_entities` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_serviceinfo_entities`(	
	IN	servicetype		VARCHAR(12),
    IN	inpage			SMALLINT(7),
    IN	inrows			SMALLINT(3),
    IN	issearch		SMALLINT(1),
    IN	searchfield		VARCHAR(12),
    IN	searchoper		VARCHAR(12),
    IN	searchstring	VARCHAR(64)
)
BEGIN
    DECLARE range1, range2		INT(10);
        
    IF (inpage = 1) THEN
		SET @range1:=0;
        SET @range2:=inrows;
	ELSEIF (inpage > 1) THEN
		SET @range1:=(inpage-1) * inrows;
        SET @range2:=inpage * inrows;
	END IF;
    
	SET @rownum:=0;
	IF (servicetype = 'Hotel') THEN    
		IF (issearch = 0) THEN
			Select id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, operdays, convcode, 
			grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
			jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, 
			datecreated from (SELECT @rownum:=@rownum+1 as rownum, id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, 
			operdays, convcode, grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
			jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, datecreated FROM hotel_info) t1 
			where rownum > @range1 and rownum <= @range2 ORDER BY rownum asc LIMIT inrows;    

		ELSEIF (issearch = 1) THEN
			IF (searchfield = 'cityname') THEN
				IF (searchoper = 'eq') THEN				
					Select id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, operdays, convcode, 
					grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, 
					datecreated from (SELECT @rownum:=@rownum+1 as rownum, id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, 
					operdays, convcode, grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, datecreated FROM hotel_info where cityname=searchstring ) t1 
					where cityname=searchstring and rownum > @range1 and rownum <= @range2 ORDER BY rownum asc LIMIT inrows;    
				ELSEIF (searchoper = 'cn') THEN
					Select id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, operdays, convcode, 
					grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, 
					datecreated from (SELECT @rownum:=@rownum+1 as rownum, id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, 
					operdays, convcode, grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, datecreated FROM hotel_info where cityname=searchstring) t1 
					where cityname LIKE CONCAT("%", searchstring, "%") and rownum > @range1 and rownum <= @range2 ORDER BY rownum asc LIMIT inrows;    
				END IF;

			ELSEIF (searchfield = 'hotel') THEN
				IF (searchoper = 'eq') THEN				
					Select id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, operdays, convcode, 
					grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, 
					datecreated from (SELECT @rownum:=@rownum+1 as rownum, id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, 
					operdays, convcode, grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, datecreated FROM hotel_info where hotel=searchstring) t1 
					where hotel=searchstring and rownum > @range1 and rownum <= @range2 ORDER BY rownum asc LIMIT inrows;    
				ELSEIF (searchoper = 'cn') THEN
					Select id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, operdays, convcode, 
					grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, 
					datecreated from (SELECT @rownum:=@rownum+1 as rownum, id, citycode, cityname, hotel, hotelstar, ourrating, room, fromdate, todate, 
					operdays, convcode, grp, epsngl, epdbl, cpsngl, cpdbl, mapsngl, mapdbl, apsngl, apdbl, eb, mealbf, mealln, mealdn, jpsngl, 
					jpdbl, mjpsngl, mjpdbl, spnoting, currcode, rate, misc, aisngl, aidbl, notitle1, notitle2, notitle3, datecreated FROM hotel_info where hotel=searchstring) t1 
					where hotel LIKE CONCAT("%", searchstring, "%") and rownum > @range1 and rownum <= @range2 ORDER BY rownum asc LIMIT inrows;    
				END IF;
			END IF;
		END IF;
	END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_get_serviceinfo_numrecords` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_serviceinfo_numrecords`(
	IN	servicetype		VARCHAR(12),
    IN	searchfield		VARCHAR(12),
    IN	searchoper		VARCHAR(12),
    IN	searchstring	VARCHAR(64),
    IN	oper			VARCHAR(12),
    OUT	totalrecords	INT(7)
    
)
BEGIN
	IF (servicetype = 'Hotel') THEN
		IF (oper = 'view') THEN
			Select Count(*) INTO totalrecords from hotel_info;
        ELSEIF (oper = 'search') THEN
			IF (searchfield = 'cityname') THEN
				IF (searchoper = 'eq') THEN				
					Select count(*) INTO totalrecords from hotel_info where cityname=searchstring;
				ELSEIF (searchoper = 'cn') THEN
					Select count(*) INTO totalrecords from hotel_info where cityname LIKE CONCAT("%", searchstring, "%");
				END IF;
			ELSEIF (searchfield = 'hotel') THEN
				IF (searchoper = 'eq') THEN				
					Select count(*) INTO totalrecords from hotel_info where hotel=searchstring;
				ELSEIF (searchoper = 'cn') THEN
					Select count(*) INTO totalrecords from hotel_info where hotel LIKE CONCAT("%", searchstring, "%");
				END IF;
			END IF;
		END IF;
	END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_get_travel_activities` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_get_travel_activities`(
	IN	itinnum	INT(11),
	IN	version	SMALLINT(2),
    IN	tenantid INT(11)
)
BEGIN
	select a.activityid, activityidpair, a.itinnum, a.actname, a.pax, a.mode, a.code, a.version, a.day, a.vesselconame, a.vesselno,
    a.bookingclass, a.bookingno, a.depdatetime, a.arrdatetime, a.depstation, a.arrstation, a.cost, a.costmarkup, a.pikupdroplocfrom,
    a.pikupdroplocto, a.pikupdropdatetime, a.pikupdropcost, a.pikupdropcostmarkup, a.vehdetails, a.asstcost, a.asstcostmarkup,
    a.commentsinternal, a.commentsexternal, a.masteractid, a.datecreated, a.dateupdated, a.lastupdatedby, a.createdby from itin_activity_travel a where a.itinnum = itinnum
    and a.version = version and a.tenantid = tenantid order by a.day ASC, a.activityid ASC;
    
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_manageservice` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_manageservice`(
		IN	inid						INT(11),
        IN	intenantid					INT(11),
        IN  inservicename	            VARCHAR(45), 
        IN  iniatacode            		VARCHAR(3), 
        IN  infullservice              	SMALLINT(1),
        IN  indomesticonly             	SMALLINT(1),
        IN	incoverage					SMALLINT(1),
        IN  inrating                	SMALLINT(1),
        IN	incity						VARCHAR(45),
        IN  incountry		         	VARCHAR(45), 
		IN	indescription				VARCHAR(120),
        IN 	incontactname				VARCHAR(30),
        IN  incontactphone				VARCHAR(15),
        IN  incontactemail				VARCHAR(120),
        IN  incontactwebsite			VARCHAR(100),
        IN	increatedby					VARCHAR(30),
		IN	inupdatedby					VARCHAR(30),        
        IN 	inaddlinfo					VARCHAR(200),
        IN  mode						VARCHAR(10),
        IN	type						SMALLINT(1),
        OUT regerror					VARCHAR(160)
)
BEGIN
        DECLARE createdby INT(10);
        DECLARE updatedby INT(10);
		DECLARE tblname	  VARCHAR(100);
        DECLARE sqltext VARCHAR(300);        
        
        IF (SELECT STRCMP(mode, 'Create') = 0) THEN
			Select id INTO @createdby from users where username=increatedby and tenantid = intenantid;
		ELSE
			Select id INTO @updatedby from users where username=inupdatedby and tenantid = intenantid;
        
        END IF;

		IF (type = 0) THEN
			IF (SELECT STRCMP(mode, 'Create') = 0) THEN
				INSERT INTO service_airlines (tenantid, servicename, iatacode, rating, city, country, contactname, contactphone, contactemail,
				contactwebsite, fullservice, domesticonly, addlinfo, datecreated, createdby, dateupdated, updatedby) 
				VALUES (intenantid, inservicename, iniatacode, inrating, incity, incountry, incontactname, incontactphone, incontactemail, 
				incontactwebsite, infullservice, indomesticonly, inaddlinfo, UTC_TIMESTAMP(), @createdby, UTC_TIMESTAMP(), @createdby);
			ELSE
				Update service_airlines SET servicename=inservicename, iatacode=iniatacode, rating=inrating, city=incity, country=incountry,
				contactname=incontactname, contactphone=incontactphone, contactemail=incontactemail, contactwebsite=incontactwebsite, fullservice=infullservice,
				domesticonly=indomesticonly, addlinfo=inaddlinfo, dateupdated=UTC_TIMESTAMP(), updatedby=@updatedby where
                id = inid and tenantid = intenantid;
			END IF;

		ELSEIF (type = 1) THEN
			IF (SELECT STRCMP(mode, 'Create') = 0) THEN
				INSERT INTO service_hotels (tenantid, servicename, rating, city, country, contactname, contactphone, contactemail,
				contactwebsite, addlinfo, datecreated, createdby, dateupdated, updatedby) 
				VALUES (intenantid, inservicename, inrating, incity, incountry, incontactname, incontactphone, incontactemail, 
				incontactwebsite, inaddlinfo, UTC_TIMESTAMP(), @createdby, UTC_TIMESTAMP(), @createdby);
			ELSE
				Update service_hotels SET servicename=inservicename, rating=inrating, city=incity, country=incountry,
				contactname=incontactname, contactphone=incontactphone, contactemail=incontactemail, contactwebsite=incontactwebsite,
				addlinfo=inaddlinfo, dateupdated=UTC_TIMESTAMP(), updatedby=@updatedby where id = inid and tenantid = intenantid;
			END IF;
		
        ELSEIF (type = 2) THEN
			IF (SELECT STRCMP(mode, 'Create') = 0) THEN
				INSERT INTO service_transport (tenantid, servicename, rating, coverage, city, country, contactname, contactphone, contactemail,
				contactwebsite, addlinfo, datecreated, createdby, dateupdated, updatedby) 
				VALUES (intenantid, inservicename, inrating, incoverage, incity, incountry, incontactname, incontactphone, incontactemail, 
				incontactwebsite, inaddlinfo, UTC_TIMESTAMP(), @createdby, UTC_TIMESTAMP(), @createdby);
			ELSE
				Update service_transport SET servicename=inservicename, rating=inrating, coverage=incoverage, city=incity, country=incountry,
				contactname=incontactname, contactphone=incontactphone, contactemail=incontactemail, contactwebsite=incontactwebsite,
				addlinfo=inaddlinfo, dateupdated=UTC_TIMESTAMP(), updatedby=@updatedby where id = inid and tenantid = intenantid;
			END IF;
		
        ELSEIF (type = 3) THEN
			IF (SELECT STRCMP(mode, 'Create') = 0) THEN
				INSERT INTO service_other (tenantid, servicename, description, rating, city, country, contactname, contactphone, contactemail,
				contactwebsite, addlinfo, datecreated, createdby, dateupdated, updatedby) 
				VALUES (intenantid, inservicename, indescription, inrating, incity, incountry, incontactname, incontactphone, incontactemail, 
				incontactwebsite, inaddlinfo, UTC_TIMESTAMP(), @createdby, UTC_TIMESTAMP(), @createdby);
			ELSE
				Update service_other SET servicename=inservicename, description=indescription, rating=inrating, city=incity, country=incountry,
				contactname=incontactname, contactphone=incontactphone, contactemail=incontactemail, contactwebsite=incontactwebsite,
				addlinfo=inaddlinfo, dateupdated=UTC_TIMESTAMP(), updatedby=@updatedby where id = inid and tenantid = intenantid;
			END IF;
        
        END IF;            
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_manageuser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_manageuser`(
		IN	intenantid					INT(11),
		IN	inemail						VARCHAR(120),
        IN  infullname		            VARCHAR(60), 
        IN  inpassword             		VARCHAR(60), 
        IN  inusername                	VARCHAR(30),
        IN	inrole						VARCHAR(25),
        IN  inphone			         	VARCHAR(20), 
        IN 	indesignation				VARCHAR(30),
        IN  reportstousername			VARCHAR(30),
        IN	createdbyusername			VARCHAR(30),
        IN  intzoffset					INT(6),
        IN  mode						VARCHAR(10),
        IN  inaccountNonLocked			SMALLINT(1),
        IN  incredentialsNonExpired		SMALLINT(1),
        OUT regerror					VARCHAR(160)
)
BEGIN

        DECLARE createdby INT(10);
        DECLARE reportsto INT(10);
        
		Select id INTO @createdby from users where username=createdbyusername and tenantid=intenantid;
		Select id INTO @reportsto from users where username=reportstousername and tenantid=intenantid;        
        		       
        IF (SELECT STRCMP(mode, 'Create') = 0) THEN
			BEGIN

				Insert INTO users ( tenantid, email, fullname, username, password, phone, designation, reportsto, createdby, level,
                               tzoffset, date_created, date_updated
							) VALUES (intenantid, inemail, infullname, inusername, inpassword, inphone, indesignation, @reportsto,
							   @createdby, 0, intzoffset, UTC_TIMESTAMP(), UTC_TIMESTAMP());
                
                Insert into user_roles_map set username=inusername, tenantid=intenantid, role=inrole, datecreated=UTC_TIMESTAMP(), dateupdated=UTC_TIMESTAMP();
            
            END;

        ELSEIF (SELECT STRCMP(mode, 'Edit') = 0) THEN

			UPDATE users SET fullname=infullname, email=inemail, phone=inphone, designation=indesignation, reportsto=@reportsto, 
							 accountNonLocked=inaccountNonLocked, credentialsNonExpired=incredentialsNonExpired, date_updated=UTC_TIMESTAMP where username=inusername and tenantid=intenantid;
			SELECT id into @userid from users where username=inusername and tenantid=intenantid;
            SELECT roleid into @roleid from user_roles where role=inrole;
			UPDATE user_roles_map SET role=inrole, datecreated=UTC_TIMESTAMP(), dateupdated=UTC_TIMESTAMP() where
				username=inusername and tenantid=intenantid;

        ELSEIF (SELECT STRCMP(mode, 'Disable') = 0) THEN
			
            UPDATE users SET enabled=0 where username=inusername and tenantid=intenantid;
        
        END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_org_exists` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_org_exists`(
        IN  orgname		               	VARCHAR(120),
        OUT organizationid				VARCHAR(15)
)
BEGIN
		select orgid INTO organizationid from plnvk_org_seq where name = orgname;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_plnvk_org_insert` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_plnvk_org_insert`(
        IN  orgname		               	VARCHAR(120), 
        IN  contactip                  	VARCHAR(45), 
        IN  isocountrycode             	VARCHAR(3), 
        IN  contactname                	VARCHAR(60),
        IN  contactphoneoffice         	VARCHAR(20), 
        IN  contactphonemobile         	VARCHAR(20),
        IN	contactemail				VARCHAR(100),
        IN 	contactdesignation			VARCHAR(45),
        IN 	tzoffset					INT(6),
        OUT organizationid				VARCHAR(15),
        OUT regerror					VARCHAR(30)
     )
BEGIN
		DECLARE oid VARCHAR(15);
        DECLARE idtemp INT(8);
        DECLARE tname CHAR(9);
        DECLARE modval INT(1);
        DECLARE sqltext VARCHAR(300);
        DECLARE rowcount INT;

        
		SELECT `AUTO_INCREMENT` INTO @idtemp FROM INFORMATION_SCHEMA.TABLES
		WHERE TABLE_SCHEMA = 'plnvk_main' AND TABLE_NAME = 'plnvk_org_seq';
        COMMIT;
        
        SELECT @idtemp MOD 10 INTO @modval;
        COMMIT;
        
        SELECT CONCAT('plnvk_org_', @modval) INTO @tname;
        COMMIT;
        
        SELECT CONCAT('01-001-', LPAD(CAST(@idtemp AS CHAR),8,'0')) INTO @oid;
        COMMIT;
                
		SELECT orgid INTO @oid FROM vrf_org_seq where name=orgname;
		SELECT FOUND_ROWS() INTO @rowcount;
        
        IF (@rowcount > 0) THEN
		BEGIN
            set regerror := 'Duplicate Name';
			set organizationid := @oid;
        END;
        ELSE
        BEGIN
			SET @sqltext := concat(
							 'INSERT INTO ', @tname, ' (
							   orgid, 
							   name, 
							   contactip, 
							   isocountrycode, 
							   contactname, 
							   contactphoneoffice,
							   contactphonemobile,
							   contactemail,
							   contactdesignation,
							   tzoffset,
							   datecreated,
							   dateupdated
							) VALUES (',
							   '\'', @oid, '\'',',',
							   '\'', orgname, '\'',',',
							   '\'', contactip, '\'',',', 
							   '\'',isocountrycode, '\'',',', 
							   '\'',contactname, '\'',',',
							   '\'', contactphoneoffice, '\'',',',
							   '\'', contactphonemobile, '\'',',',
							   '\'', contactemail, '\'',',',
							   '\'',contactdesignation, '\'',',',
							   tzoffset,',',
							   '\'', UTC_TIMESTAMP(), '\'',',',
							   '\'', UTC_TIMESTAMP(), '\'',
							 ')');


			PREPARE stmt FROM @sqltext;
			EXECUTE stmt;
			DEALLOCATE PREPARE stmt;
			
			insert into plnvk_org_seq set id = @id, name=orgname, orgid=@oid;
            
            insert into plnvk_admin_tasks set subid=0, orgid=@oid, code=0, assignedto=1, status=0, 
            remarks='New org - requires verification', datecreated=UTC_TIMESTAMP(), dateupdated=UTC_TIMESTAMP();
		
		set organizationid := @oid;
		COMMIT;
		END;
        END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_save_itinerary` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_save_itinerary`(
	IN itinnum INT(11),
    IN tenantid INT(11),
	IN name VARCHAR(50),
    IN mode VARCHAR(15),
    IN status VARCHAR(10),
    IN version SMALLINT(2),
    IN touroperator VARCHAR(30),
    IN grouphead VARCHAR(30),
    IN numtravellers SMALLINT,
    IN startdate DATETIME,
    IN enddate DATETIME,
    IN arrivalcity VARCHAR(30),
    IN depcity VARCHAR(30),
    IN quotecurrency VARCHAR(3),
    IN convcode INT(11),
    IN lastupdatedbyusername VARCHAR(30)
)
BEGIN
		DECLARE lastupdatedby INT(11);
        DECLARE activitymastercnt SMALLINT(2);
    	
		Select id INTO @lastupdatedby from users where username=lastupdatedbyusername and tenantid=tenantid;
		Select itinnum into @initinnum;
        
        update itin_master SET name=name, version=version, status=status, touroperator=touroperator, grouphead=grouphead, 
        numtravellers=numtravellers, startdate=startdate, enddate=enddate, arrivalcity=arrivalcity, 
        depcity=depcity, quotecurrency=quotecurrency, convcode=convcode, lastupdatedby=@lastupdatedby, dateupdated=UTC_TIMESTAMP()
        where id=itinnum and tenantid=tenantid;
        
        
    
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_save_travelactivity` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_save_travelactivity`(
    IN initinnum 				INT(11),
    IN intenantid				INT(11),
    IN inactname 				VARCHAR(60),
    IN lastupdatedbyemail 		VARCHAR(120),
    IN incode 					VARCHAR(20),
    IN inversion 				SMALLINT(2),
    IN inactivityid 			INT(11),
    IN inpax 					SMALLINT(5),
    IN inmode					SMALLINT(3),
    IN invesselnoon				VARCHAR(15),
	IN invesselnoret			VARCHAR(15),
    IN invesselconame 			VARCHAR(20),
    IN inbookingno 				VARCHAR(10),
    IN inbookingclass 			VARCHAR(10),
    IN indepdatetimeon 			DATETIME,
    IN inarrdatetimeon 			DATETIME,
    IN indepdatetimeret			DATETIME,
    IN inarrdatetimeret			DATETIME,
    IN inarrstation 			VARCHAR(30),
    IN indepstation 			VARCHAR(30),
    IN incost					DECIMAL(10,2),
    IN incostmarkup				SMALLINT(3),
    IN inasstcost				DECIMAL(10,2),
    IN inasstcostmarkup			SMALLINT(3),
    IN inpikupdroplocfrom		VARCHAR(30),
    IN inpikupdroplocto			VARCHAR(30),
    IN inpikupdropdatetime		DATETIME,
	IN invehdetails				VARCHAR(45),
    IN inpikupdropcost			DECIMAL(10,2),
    IN inpikupdropcostmarkup	SMALLINT(3),
	IN incommentsinternal		VARCHAR(200),
	IN incommentsexternal		VARCHAR(200),
    OUT outactivityid			INT(11),
    OUT outactivityidpair		INT(11)
)
BEGIN
		DECLARE lastupdatedby	INT(10);
        DECLARE activitycnt   	INT(5);
        DECLARE aid				INT(11);
    	
		Select id INTO @lastupdatedby from users where username=lastupdatedbyemail and tenantid=intenantid;
        
        
        IF (incode = 'T_PIKUPDRP') THEN

			IF (inactivityid=0) THEN
				Insert into itin_activity_travel (actname, itinnum, tenantid, pax, mode, code, version, vesselconame, vesselnoon, 
				pikupdroplocfrom, pikupdroplocto, pikupdropdatetime, pikupdropcost, pikupdropcostmarkup, vehdetails, asstcost, asstcostmarkup,
				commentsinternal, commentsexternal, datecreated, dateupdated, lastupdatedby, createdby) values (inactname, initinnum, intenantid, inpax, 
				inmode, incode, inversion, invesselconame, invesselnoon, inpikupdroplocfrom, inpikupdroplocto, inpikupdropdatetime, inpikupdropcost, 
				inpikupdropcostmarkup, invehdetails, inasstcost, inasstcostmarkup, incommentsinternal,  incommentsexternal, UTC_TIMESTAMP(), 
				UTC_TIMESTAMP(), 1,  1);
        
				SELECT LAST_INSERT_ID() INTO outactivityid;
                
				
            ELSE
				Update itin_activity_travel Set actname=inactname, itinnum=initinnum, pax=inpax, mode=inmode, code=incode, version=inversion, 
				vesselconame=invesselconame, vesselnoon=invesselnoon, pikupdroplocfrom=inpikupdroplocfrom, pikupdroplocto=inpikupdroplocto, pikupdropdatetime=inpikupdropdatetime, 
                pikupdropcost=inpikupdropcost, pikupdropcostmarkup=inpikupdropcostmarkup, vehdetails=invehdetails, asstcost=inasstcost, asstcostmarkup=inasstcostmarkup, 
                commentsinternal=incommentsinternal, commentsexternal=incommentsexternal, dateupdated=UTC_TIMESTAMP(), lastupdatedby=@lastupdatedby
				where activityid=inactivityid;
				
                SELECT inactivityid INTO outactivityid;
                
			END IF;

        ELSEIF (incode = 'T_BOOK_ONEWAY') THEN

			IF (inactivityid=0) THEN

				Insert into itin_activity_travel (actname, itinnum, tenantid, pax, mode, code, version, vesselconame, vesselnoon, bookingclass, bookingno, depdatetimeon,
				arrdatetimeon, depstation, arrstation, cost, costmarkup, commentsinternal, commentsexternal, datecreated, dateupdated, lastupdatedby, createdby) 
                values (inactname, initinnum, intenantid, inpax, inmode, incode, inversion, invesselconame, invesselnoon, inbookingclass, inbookingno, indepdatetimeon, 
                inarrdatetimeon, indepstation, inarrstation, incost, incostmarkup, incommentsinternal, incommentsexternal, UTC_TIMESTAMP(), UTC_TIMESTAMP(), @lastupdatedby,  @lastupdatedby);
            
                SELECT LAST_INSERT_ID() INTO outactivityid;
				
			ELSE
				Update itin_activity_travel Set actname=inactname, itinnum=initinnum, tenantid=intenantid, pax=inpax, mode=inmode, code=incode, version=inversion, 
                vesselconame=invesselconame, vesselnoon=invesselnoon, bookingclass=inbookingclass, bookingno=inbookingno, depdatetimeon=indepdatetimeon, arrdatetimeon=inarrdatetimeon,
                depstation=indepstation, arrstation=inarrstation, cost=incost, costmarkup=incostmarkup, commentsinternal=incommentsinternal, commentsexternal=incommentsexternal, dateupdated=UTC_TIMESTAMP(), lastupdatedby=@lastupdatedby
                where activityid=inactivityid;

				SELECT inactivityid INTO outactivityid;
			END IF;

        ELSEIF (incode = 'T_BOOK_RETURN') THEN

			IF (inactivityid=0) THEN        
   				Insert into itin_activity_travel (actname, itinnum, tenantid, pax, mode, code, version, vesselconame, vesselnoon, bookingclass, bookingno, depdatetimeon,
				arrdatetimeon, depstation, arrstation, cost, costmarkup, commentsinternal, commentsexternal, datecreated, dateupdated, lastupdatedby, createdby) values (inactname, initinnum, intenantid, inpax, inmode, 
                incode, inversion, invesselconame, invesselnoon, inbookingclass, inbookingno, indepdatetimeon, inarrdatetimeon, indepstation, 
                inarrstation, incost, incostmarkup, incommentsinternal, incommentsexternal, UTC_TIMESTAMP(), UTC_TIMESTAMP(), @lastupdatedby,  @lastupdatedby);

                SELECT LAST_INSERT_ID() INTO outactivityid;

   				Insert into itin_activity_travel (actname, itinnum, tenantid, pax, mode, code, version, vesselconame, vesselnoret, bookingclass, bookingno, depdatetimeret,
				arrdatetimeret, depstation, arrstation, cost, costmarkup, commentsinternal, commentsexternal, datecreated, dateupdated, lastupdatedby, createdby) values (inactname, initinnum, intenantid, inpax, inmode, 
                incode, inversion, invesselconame, invesselnoret, inbookingclass, inbookingno, indepdatetimeret, inarrdatetimeret, inarrstation, 
                indepstation, incost, incostmarkup, incommentsinternal, incommentsexternal, UTC_TIMESTAMP(), UTC_TIMESTAMP(), @lastupdatedby,  @lastupdatedby);
		
                SELECT LAST_INSERT_ID() INTO outactivityidpair;
                
                update itin_activity_travel Set activityidpair=outactivityidpair where activityid=outactivityid;
                update itin_activity_travel Set activityidpair=outactivityid where activityid=outactivityidpair;
                
			ELSE 
				IF (SELECT LENGTH(invesselnoon) > 0) THEN
					Update itin_activity_travel Set actname=inactname, itinnum=initinnum, tenantid=intenantid, pax=inpax, mode=inmode, code=incode, version=inversion, 
					vesselconame=invesselconame, vesselnoon=invesselnoon, bookingclass=inbookingclass, bookingno=inbookingno, depdatetimeon=indepdatetimeon, arrdatetimeon=inarrdatetimeon,
					depstation=indepstation, arrstation=inarrstation, cost=incost, costmarkup=incostmarkup, commentsinternal=incommentsinternal, commentsexternal=incommentsexternal, dateupdated=UTC_TIMESTAMP(), lastupdatedby=@lastupdatedby
					where activityid=inactivityid;
				ELSE
					Update itin_activity_travel Set actname=inactname, itinnum=initinnum, tenantid=intenantid, pax=inpax, mode=inmode, code=incode, version=inversion, 
					vesselconame=invesselconame, vesselnoret=invesselnoret, bookingclass=inbookingclass, bookingno=inbookingno, depdatetimeret=indepdatetimeret, arrdatetimeret=inarrdatetimeret,
					depstation=indepstation, arrstation=inarrstation, cost=incost, costmarkup=incostmarkup, commentsinternal=incommentsinternal, commentsexternal=incommentsexternal, dateupdated=UTC_TIMESTAMP(), lastupdatedby=@lastupdatedby
					where activityid=inactivityid;

				END IF;

            END IF;

        END IF;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_service_exists` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_service_exists`(
        IN  inservicename      	VARCHAR(30),
        IN 	intenantid			INT(11),
        IN  type				SMALLINT(2),
        OUT serviceid			INT(10)
)
BEGIN
		IF (type = 0) THEN
			select id into serviceid from service_airlines where servicename = inservicename and tenantid = intenantid;
        ELSEIF (type = 1) THEN
			select id into serviceid from service_hotels where servicename = inservicename and tenantid = intenantid;
        ELSEIF (type = 2) THEN
			select id into serviceid from service_transport where servicename = inservicename and tenantid = intenantid;
        ELSEIF (type = 3) THEN
			select id into serviceid from service_other where servicename = inservicename and tenantid = intenantid;
        END IF;
        
        IF (serviceid IS NULL) THEN
			SET serviceid = 0;
		END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_updatetenantinuser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_updatetenantinuser`(
	IN	intenantid				INT(11),
    IN	inusername				VARCHAR(120),
	IN	infullname				VARCHAR(60),
	IN	inpassword				VARCHAR(60),
	IN	inphone					VARCHAR(20),
    IN	indesignation			VARCHAR(30),
	IN	increatedyby			INT(10),
	IN	inlevel					SMALLINT(3),
	IN	inenabled				TINYINT(1),
	IN	inrole					VARCHAR(25),
	IN	inaccountnonexpired		TINYINT(1),
	IN	inaccountnonlocked		TINYINT(1),
	IN	incredentialsnonexpired	TINYINT(1),
	IN	intzoffset				INT(6)
)
BEGIN

	Insert into users (tenantid, email, fullname, username, password, phone, designation, reportsto, createdby,
					level, enabled, accountNonExpired, accountNonLocked, credentialsNonExpired, tzoffset)
					Values (intenantid, inusername, infullname, inusername, inpassword, inphone, indesignation,
					1, 1, 0, 1, 1, 1, 1, intzoffset);
                        
    Insert into user_roles_map (tenantid, username, role) values (intenantid, inusername, inrole);
                            
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_updateuser` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_updateuser`(
	IN 	inpass		VARCHAR(60),
    IN  inid		INT(10),
    IN 	intenantid	INT(11)
)
BEGIN
		update users set password=inpass, credentialsNonExpired=1, date_updated=UTC_TIMESTAMP() where id=inid and tenantid=intenantid;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_updateuserpassword` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_updateuserpassword`(
	IN 	inpass		VARCHAR(60),
    IN  inid		INT(10),
    IN 	intenantid	INT(11)
)
BEGIN
	update users set password=inpass, credentialsNonExpired=1, date_updated=UTC_TIMESTAMP() where id=inid and tenantid=intenantid;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_update_serviceinfo` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_update_serviceinfo`(	
	IN	servicetype		VARCHAR(12),
	IN	inid			INT(10),
    IN	incitycode		VARCHAR(5),
    IN	incityname		VARCHAR(25),
    IN	inhotel			VARCHAR(45),
    IN	inhotelstar		VARCHAR(25),
    IN	inourrating		VARCHAR(25),
    IN	inroom			VARCHAR(45),
    IN	infromdate		VARCHAR(25),
    IN	intodate		VARCHAR(25),
    IN	inoperdays		VARCHAR(12),
    IN	inconvcode		VARCHAR(3),
    IN	ingrp			VARCHAR(3),
    IN	inepsngl		VARCHAR(12),
    IN	inepdbl			VARCHAR(12),
    IN	incpsngl		VARCHAR(12),
    IN	incpdbl			VARCHAR(12),
    IN	inmapsngl		VARCHAR(12),
    IN	inmapdbl		VARCHAR(12),
    IN	inapsngl		VARCHAR(12),
    IN	inapdbl			VARCHAR(12),
    IN	ineb			VARCHAR(12),
    IN	inmealbf		VARCHAR(12),
    IN	inmealln		VARCHAR(12),
    IN	inmealdn		VARCHAR(12),
    IN	injpsngl		VARCHAR(12),
    IN	injpdbl			VARCHAR(12),
    IN	inmjpsngl		VARCHAR(12),
    IN	inmjpdbl		VARCHAR(12),
    IN	inspnoting		VARCHAR(255),
    IN	incurrcode		VARCHAR(3),
    IN	inrate			VARCHAR(12),
    IN	inmisc			VARCHAR(25),
    IN	inaisngl		VARCHAR(100),
    IN	inaidbl			VARCHAR(25),
    IN	innotitle1		VARCHAR(45),
    IN	innotitle2		VARCHAR(45),
    IN	innotitle3		VARCHAR(45)
    
)
BEGIN
	IF (servicetype = 'Hotel') THEN
		Update hotel_info Set citycode=incitycode, cityname=incityname, hotel=inhotel, hotelstar=inhotelstar, 
        ourrating=inourrating, room=inroom, fromdate=infromdate, todate=intodate, operdays=inoperdays, 
        convcode=inconvcode, grp=ingrp, epsngl=inepsngl, epdbl=inepdbl, cpsngl=incpsngl, cpdbl=incpdbl, 
        mapsngl=inmapsngl, mapdbl=inmapdbl, apsngl=inapsngl, apdbl=inapdbl, eb=ineb, mealbf=inmealbf, 
        mealln=inmealln, mealdn=inmealdn, jpsngl=injpsngl, jpdbl=injpdbl, mjpsngl=inmjpsngl, mjpdbl=inmjpdbl, 
		spnoting=inspnoting, currcode=incurrcode, rate=inrate, misc=inmisc, aisngl=inaisngl, aidbl=inaidbl, 
        notitle1=innotitle1, notitle2=innotitle2, notitle3=innotitle3, dateupdated=UTC_TIMESTAMP() where id=inid;
	END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_user_exists` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_user_exists`(
        IN  inusername		               	VARCHAR(30),
        IN	intenantid						INT(11),
        OUT userid							INT(10)
)
BEGIN
		select id into userid from users where username = inusername and tenantid = intenantid;
        IF (userid IS NULL) THEN
			SET userid = 0;
		END IF;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2015-08-25  9:50:58
